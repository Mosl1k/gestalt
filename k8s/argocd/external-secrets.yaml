# External Secrets Operator configuration
# This allows syncing secrets from GitHub Secrets or other secret stores
# Install External Secrets Operator first: https://external-secrets.io/

apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: github-secrets
  namespace: gestalt
spec:
  provider:
    github:
      owner: Mosl1k
      repository: gestalt
      auth:
        app:
          # GitHub App credentials (recommended)
          # Or use personal access token
          privateKey:
            secretRef:
              name: github-app-private-key
              key: private-key
          appId:
            secretRef:
              name: github-app-id
              key: app-id
          installationId:
            secretRef:
              name: github-installation-id
              key: installation-id

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: gestalt-secrets
  namespace: gestalt
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: github-secrets
    kind: SecretStore
  target:
    name: gestalt-secrets
    creationPolicy: Owner
    template:
      type: Opaque
      data:
        REDIS_PASSWORD: "{{ .REDIS_PASSWORD }}"
        SESSION_SECRET: "{{ .SESSION_SECRET }}"
        YANDEX_CLIENT_ID: "{{ .YANDEX_CLIENT_ID }}"
        YANDEX_CLIENT_SECRET: "{{ .YANDEX_CLIENT_SECRET }}"
        TELEGRAM_TOKEN: "{{ .TELEGRAM_TOKEN }}"
        SERVICE_USER_ID: "{{ .SERVICE_USER_ID }}"
  data:
  - secretKey: REDIS_PASSWORD
    remoteRef:
      key: gestalt
      property: REDIS_PASSWORD
  - secretKey: SESSION_SECRET
    remoteRef:
      key: gestalt
      property: SESSION_SECRET
  - secretKey: YANDEX_CLIENT_ID
    remoteRef:
      key: gestalt
      property: YANDEX_CLIENT_ID
  - secretKey: YANDEX_CLIENT_SECRET
    remoteRef:
      key: gestalt
      property: YANDEX_CLIENT_SECRET
  - secretKey: TELEGRAM_TOKEN
    remoteRef:
      key: gestalt
      property: TELEGRAM_TOKEN
  - secretKey: SERVICE_USER_ID
    remoteRef:
      key: gestalt
      property: SERVICE_USER_ID

